#include <array>
#include <iostream>
#include <string_view>
#include <unistd.h>

// Never called
void callme() {
    system("/bin/sh");
    asm volatile (
      "pop %rdi\n"
      "ret");
}

// Trims last new line characters if they are presented
std::string_view trim(std::string_view str) {
    if (const auto pos = str.find('\n'); pos != std::string_view::npos) {
        str.remove_suffix(str.size() - pos);
    }
    return str;
}

bool auth() {
    // Password is hardcoded but could be retrieved from the outside
    std::array<char, 11> requiredPassword{"1111111111"};
    std::array<char, 20> enteredPassword{0};

    std::cout << "Enter a password: " << std::endl;

    // WARNING, UNSAFE!
    read(0, enteredPassword.data(), 200);

    return trim(enteredPassword.data()) == requiredPassword.data();
}

int main(int argc, char *argv[]) {
    const auto status{auth()};
    status ? std::cout << "Authentication SUCCEEDED" << std::endl
           : std::cout << "Authentication FAILED" << std::endl;
    return 0;
}